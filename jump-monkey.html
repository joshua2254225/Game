<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monkey Jump â€” Springspiel</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    :root{
      --accent: #0b74de;
      --ground: #2e8b57;
      --sand: #f4e8c1;
      --sky1: #a9e1ff;
      --sky2: #7fcfff;
      --panel-bg: #ffffff;
    }
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
    header,footer{background:var(--accent); color:white; padding:12px 16px;}
    header h1{margin:0;font-size:20px;display:inline-block;}
    nav{margin-top:8px;}
    nav a{color:#fff;margin-right:10px;text-decoration:none;font-weight:600;font-size:14px;}
    .wrap{max-width:980px;margin:18px auto;padding:0 12px;}
    .panel{background:var(--panel-bg);border-radius:10px;padding:12px;box-shadow:0 8px 24px rgba(12,20,30,.06);}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px;}
    .controls button{background:#fff;border:1px solid #ddd;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .controls .score{margin-left:auto;font-weight:700}
    canvas{display:block;width:100%;height:auto;border-radius:8px;background:linear-gradient(180deg,var(--sky1),var(--sky2));}
    .hint{font-size:13px;color:#666;margin-top:8px}
    @media (max-width:480px){
      header h1{font-size:18px}
      .controls .score{margin-left:6px}
    }
  </style>
</head>
<body>
  <header>
    <h1>Monkey Jump</h1>
    <nav>
      <a href="/Game/index.html">Home</a>
      <a href="/Game/color-clicker.html">Color Clicker</a>
      <a href="/Game/emoji-memory.html">Emoji Memory</a>
      <a href="/Game/about.html">About</a>
      <a href="/Game/privacy.html">Privacy</a>
    </nav>
  </header>

  <div class="wrap">
    <div class="panel">
      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="restartBtn">Restart</button>
        <div>Best: <strong id="best">0</strong></div>
        <div class="score">Score: <strong id="score">0</strong></div>
      </div>

      <canvas id="gameCanvas" width="960" height="360" aria-label="Monkey Jump Spiel"></canvas>
      <div class="hint">Steuerung: Leertaste / Klick / Tippen = Springen. Ãœberspringe die KokosnÃ¼sse ðŸ¥¥. Viel SpaÃŸ!</div>
    </div>
  </div>

  <footer><p style="margin:0;padding:0 12px;">Â© My Games Site</p></footer>

  <script>
  (function(){
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      const ratio = window.devicePixelRatio || 1;
      const width = Math.min(1200, Math.max(320, Math.floor(Math.min(window.innerWidth - 40, 960))));
      const height = Math.floor(width * 0.375); // 960x360 ratio
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      canvas.width = Math.floor(width * ratio);
      canvas.height = Math.floor(height * ratio);
      ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const groundHeight = 64;
    let lastTime = 0;
    let score = 0;
    let best = parseInt(localStorage.getItem('monkey_jump_best') || '0', 10);
    document.getElementById('best').textContent = best;

    const monkey = {
      x: 120,
      y: 0,
      size: 64,
      vy: 0,
      gravity: 2200,
      jumpVelocity: -800,
      baseline: 0,
      alive: true
    };

    let obstacles = [];
    let spawnTimer = 0;
    let spawnInterval = 1400;
    let speed = 320;
    let running = false;

    // palms (parallax) - will be positioned relative to ground
    const palms = [
      {x: 60, baseOffset: 40, size: 48},
      {x: 420, baseOffset: 30, size: 64},
      {x: 760, baseOffset: 50, size: 56}
    ];

    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function computeLayout() {
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const height = parseFloat(canvas.style.height) || canvas.height/(window.devicePixelRatio||1);
      // baseline: place monkey slightly above ground top so it visually stands on sand
      monkey.baseline = height - groundHeight + 8; // bottom coordinate where emoji is drawn (textBaseline 'bottom')
      monkey.y = monkey.baseline; // baseline used for physics (feet position)
      // ensure palms anchored relative to ground:
      palms.forEach((p,i) => {
        if (!p.x || p.x > width) p.x = rand(width * (0.1 + 0.2*i), width * (0.4 + 0.2*i));
        p.y = monkey.baseline - (p.size * 0.9); // place palm so trunk base meets ground
      });
    }

    computeLayout();
    window.addEventListener('resize', () => { resizeCanvas(); computeLayout(); render(); });

    function resetGame() {
      score = 0; obstacles = []; spawnTimer = 0; spawnInterval = 1400; speed = 320;
      running = false; monkey.vy = 0;
      computeLayout();
      scoreEl.textContent = score;
      startBtn.disabled = false;
    }

    function startGame() {
      resetGame();
      running = true;
      startBtn.disabled = true;
      lastTime = performance.now();
      requestAnimationFrame(loop);
    }

    function restartGame() {
      resetGame();
      render();
    }

    function spawnObstacle() {
      const cSize = 44 + Math.floor(rand(-6,10));
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const x = width + 40;
      // place coconut so its bottom sits on same ground baseline (slightly inset)
      const y = monkey.baseline - cSize + 6;
      obstacles.push({x, y, w: cSize, h: cSize, passed: false});
      spawnInterval = Math.max(700, 1400 - score*20);
    }

    function drawPalms() {
      const cw = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      palms.forEach((p,i) => {
        ctx.font = `${p.size}px serif`;
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('ðŸŒ´', p.x, p.y + p.size*0.9);
      });
    }

    function render() {
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const height = parseFloat(canvas.style.height) || canvas.height/(window.devicePixelRatio||1);

      // sky
      const grad = ctx.createLinearGradient(0,0,0,height);
      grad.addColorStop(0, '#a9e1ff');
      grad.addColorStop(1, '#7fcfff');
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,width,height);

      // sun
      ctx.beginPath();
      ctx.fillStyle = '#ffd166';
      ctx.arc(width - 80, 60, 28, 0, Math.PI*2);
      ctx.fill();

      // palms
      drawPalms();

      // ground / sand
      ctx.fillStyle = '#f4e8c1';
      ctx.fillRect(0, height - groundHeight, width, groundHeight);
      ctx.fillStyle = '#2e8b57';
      ctx.fillRect(0, height - groundHeight, width, 8);

      // monkey
      ctx.font = monkey.size + 'px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom'; // draw at baseline coordinate
      ctx.fillText('ðŸ’', monkey.x, monkey.baseline);

      // obstacles (coconuts)
      ctx.font = '40px serif';
      obstacles.forEach(obj => {
        ctx.fillText('ðŸ¥¥', obj.x + obj.w/2, obj.y + obj.h*0.9);
        // shadow
        ctx.fillStyle = 'rgba(0,0,0,0.12)';
        ctx.fillRect(obj.x + 6, obj.y + obj.h - 6, obj.w - 12, 4);
        ctx.fillStyle = '#000';
      });
    }

    // simple circle-based collision for robustness
    function checkCollisions() {
      // monkey center
      const mx = monkey.x;
      const my = monkey.baseline - monkey.size*0.45; // center approx
      const mr = monkey.size * 0.45;
      for (let i = 0; i < obstacles.length; i++) {
        const o = obstacles[i];
        const ox = o.x + o.w/2;
        const oy = o.y + o.h/2;
        const or = Math.max(16, (o.w/2) * 0.9);
        const dx = mx - ox;
        const dy = my - oy;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < mr + or) {
          return true;
        }
      }
      return false;
    }

    function loop(now) {
      if (!running) return;
      const dt = Math.min(0.05, (now - lastTime) / 1000);
      lastTime = now;

      // move palms slowly (parallax)
      const cw = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      palms.forEach((p,i) => {
        const palmSpeed = 20 + i*6;
        p.x -= palmSpeed * dt;
        if (p.x < -120) {
          p.x = cw + rand(20, 200);
          p.y = monkey.baseline - (p.size * 0.9);
        }
      });

      // physics
      monkey.vy += monkey.gravity * dt;
      // treat monkey.baseline as feet position; track vertical offset from baseline as -jumpHeight
      monkey.y += monkey.vy * dt;
      if (monkey.y > monkey.baseline) {
        monkey.y = monkey.baseline;
        monkey.vy = 0;
      }

      spawnTimer += dt * 1000;
      if (spawnTimer > spawnInterval) {
        spawnTimer = 0;
        spawnObstacle();
      }

      // move obstacles
      const move = speed * dt;
      for (let i = obstacles.length - 1; i >= 0; i--) {
        obstacles[i].x -= move;
        if (obstacles[i].x + obstacles[i].w < -40) obstacles.splice(i,1);
      }

      // check collisions
      if (checkCollisions()) {
        running = false;
        startBtn.disabled = false;
        if (score > best) {
          best = score;
          localStorage.setItem('monkey_jump_best', String(best));
          bestEl.textContent = best;
        }
        setTimeout(()=> alert('Oh nein â€” getroffen! Dein Score: ' + score), 60);
        render();
        return;
      }

      // scoring: count obstacles passed
      obstacles.forEach((o) => {
        if (!o.passed && (o.x + o.w/2) < monkey.x - 10) {
          o.passed = true;
          score += 1;
          scoreEl.textContent = score;
          speed += 6;
        }
      });

      render();
      if (running) requestAnimationFrame(loop);
    }

    function jump() {
      if (!running) return;
      // only allow jump if near baseline
      if (Math.abs(monkey.y - monkey.baseline) < 6) {
        monkey.vy = monkey.jumpVelocity;
      }
    }

    // inputs
    window.addEventListener('keydown', (e)=>{
      if (e.code === 'Space') {
        e.preventDefault();
        if (!running) startGame();
        else jump();
      }
    });

    canvas.addEventListener('pointerdown', (e)=>{
      if (!running) startGame();
      else jump();
    });

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', restartGame);

    // init
    resetGame();
    render();

    // Expose for debugging
    window.__monkeyJump = { startGame, restartGame, spawnObstacle, obstacles, palms };
  })();
  </script>
</body>
  </html>
