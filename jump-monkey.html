<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Monkey Jump â€” Springspiel</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    :root{--accent:#0b74de;--ground:#2e8b57;--sand:#f4e8c1;--sky1:#a9e1ff;--sky2:#7fcfff;}
    html,body{height:100%;margin:0;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Arial;}
    header,footer{background:var(--accent); color:white; padding:12px 16px;}
    header h1{margin:0;font-size:20px;display:inline-block;}
    nav{margin-top:8px;} nav a{color:#fff;margin-right:10px;text-decoration:none;font-weight:600;font-size:14px;}
    .wrap{max-width:980px;margin:18px auto;padding:0 12px;}
    .panel{background:#fff;border-radius:10px;padding:12px;box-shadow:0 8px 24px rgba(12,20,30,.06);}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px;}
    .controls button{background:#fff;border:1px solid #ddd;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    .controls .score{margin-left:auto;font-weight:700}
    canvas{display:block;width:100%;height:auto;border-radius:8px;background:linear-gradient(180deg,var(--sky1),var(--sky2));}
    .hint{font-size:13px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <h1>Monkey Jump</h1>
    <nav>
      <a href="/Game/index.html">Home</a>
      <a href="/Game/color-clicker.html">Color Clicker</a>
      <a href="/Game/emoji-memory.html">Emoji Memory</a>
      <a href="/Game/jump-monkey.html">Monkey Jump</a>
      <a href="/Game/about.html">About</a>
      <a href="/Game/privacy.html">Privacy</a>
    </nav>
  </header>

  <div class="wrap">
    <div class="panel">
      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="restartBtn">Restart</button>
        <div>Best: <strong id="best">0</strong></div>
        <div class="score">Score: <strong id="score">0</strong></div>
      </div>

      <canvas id="gameCanvas" width="960" height="360" aria-label="Monkey Jump Spiel"></canvas>
      <div class="hint">Steuerung: Leertaste / Klick / Tippen = Springen. Ãœberspringe die KokosnÃ¼sse ðŸ¥¥.</div>
    </div>
  </div>

  <footer><p style="margin:0;padding:0 12px;">Â© My Games Site</p></footer>

  <script>
  (function(){
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas(){
      const ratio = window.devicePixelRatio || 1;
      const width = Math.min(1200, Math.max(320, Math.floor(Math.min(window.innerWidth - 40, 960))));
      const height = Math.floor(width * 0.375);
      canvas.style.width = width + 'px'; canvas.style.height = height + 'px';
      canvas.width = Math.floor(width * ratio); canvas.height = Math.floor(height * ratio);
      ctx.setTransform(ratio,0,0,ratio,0,0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const groundHeight = 64;
    let lastTime = 0;
    let score = 0;
    let best = parseInt(localStorage.getItem('monkey_jump_best') || '0', 10);
    document.getElementById('best').textContent = best;

    // kleinere Affe
    const monkey = {
      x: 120,
      y: 0,         // bottom coordinate (where emoji bottom is drawn)
      size: 40,     // <-- kleinerer Affe (angepasst)
      vy: 0,
      gravity: 2200,
      jumpVelocity: -720,
      baseline: 0
    };

    // Obstacles & Spawn (random Abstand)
    let obstacles = [];
    let spawnTimer = 0;
    let nextSpawn = 0;
    // spawnRange wird mit Score kleiner -> dichter
    function computeSpawnRange() {
      const min = Math.max(500, 1200 - score * 25); // min ms
      const max = min + 800; // variable window
      return [min, max];
    }

    // Start langsam, steigt dann
    let speed = 180;           // <-- start langsamer
    let running = false;
    let accelTimer = 0;

    // Parallax Palmen
    const palms = [
      {x:60,size:48},
      {x:420,size:64},
      {x:760,size:56}
    ];

    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function computeLayout(){
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const height = parseFloat(canvas.style.height) || canvas.height/(window.devicePixelRatio||1);
      monkey.baseline = height - groundHeight + 6;
      monkey.y = monkey.baseline;
      palms.forEach((p,i)=> {
        if (!p.x || p.x > width) p.x = rand(width * (0.1 + 0.2*i), width * (0.4 + 0.2*i));
        p.y = monkey.baseline - (p.size * 0.9);
      });
    }
    computeLayout();
    window.addEventListener('resize', ()=>{ resizeCanvas(); computeLayout(); render(); });

    function resetGame(){
      score = 0; obstacles = []; spawnTimer = 0; speed = 180; accelTimer = 0;
      running = false; monkey.vy = 0;
      const [min,max] = computeSpawnRange(); nextSpawn = rand(min,max);
      computeLayout();
      scoreEl.textContent = score;
      startBtn.disabled = false;
    }

    function startGame(){
      resetGame();
      running = true;
      startBtn.disabled = true;
      lastTime = performance.now();
      requestAnimationFrame(loop);
    }

    function restartGame(){
      resetGame();
      render();
    }

    function spawnObstacle(){
      const cSize = 32 + Math.floor(rand(-4,10)); // variable coconut size
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const x = width + 40 + rand(0,120); // extra small random offset
      const y = monkey.baseline - cSize + 6;
      obstacles.push({x,y,w:cSize,h:cSize,passed:false});
      const [min,max] = computeSpawnRange();
      nextSpawn = rand(min,max);
    }

    function drawPalms(){
      const cw = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      palms.forEach((p,i)=>{
        ctx.font = `${p.size}px serif`;
        ctx.textBaseline = 'alphabetic';
        ctx.fillText('ðŸŒ´', p.x, p.y + p.size*0.9);
      });
    }

    function render(){
      const width = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      const height = parseFloat(canvas.style.height) || canvas.height/(window.devicePixelRatio||1);

      // sky
      const grad = ctx.createLinearGradient(0,0,0,height);
      grad.addColorStop(0, '#a9e1ff'); grad.addColorStop(1,'#7fcfff');
      ctx.fillStyle = grad; ctx.fillRect(0,0,width,height);

      // sun
      ctx.beginPath(); ctx.fillStyle = '#ffd166'; ctx.arc(width-80,60,28,0,Math.PI*2); ctx.fill();

      // palms
      drawPalms();

      // ground
      ctx.fillStyle = '#f4e8c1'; ctx.fillRect(0, height - groundHeight, width, groundHeight);
      ctx.fillStyle = '#2e8b57'; ctx.fillRect(0, height - groundHeight, width, 8);

      // monkey (draw at bottom coordinate monkey.y)
      ctx.font = monkey.size + 'px serif';
      ctx.textAlign = 'center'; ctx.textBaseline = 'bottom';
      ctx.fillText('ðŸ’', monkey.x, monkey.y);

      // obstacles
      ctx.font = '36px serif';
      obstacles.forEach(obj=>{
        ctx.fillText('ðŸ¥¥', obj.x + obj.w/2, obj.y + obj.h*0.9);
        // tiny shadow
        ctx.fillStyle = 'rgba(0,0,0,0.12)';
        ctx.fillRect(obj.x + 6, obj.y + obj.h - 6, obj.w - 12, 4);
        ctx.fillStyle = '#000';
      });
    }

    // circle collision
    function checkCollisions(){
      const mx = monkey.x;
      const my = monkey.y - monkey.size*0.45;
      const mr = monkey.size * 0.42;
      for(let i=0;i<obstacles.length;i++){
        const o = obstacles[i];
        const ox = o.x + o.w/2;
        const oy = o.y + o.h/2;
        const or = Math.max(10,(o.w/2)*0.9);
        const dx = mx - ox; const dy = my - oy;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if(dist < mr + or) return true;
      }
      return false;
    }

    // main loop
    function loop(now){
      if(!running) return;
      const dt = Math.min(0.05,(now - lastTime)/1000);
      lastTime = now;

      // parallax palms movement
      const cw = parseFloat(canvas.style.width) || canvas.width/(window.devicePixelRatio||1);
      palms.forEach((p,i)=>{ const palmSpeed = 18 + i*6; p.x -= palmSpeed * dt; if(p.x < -140) p.x = cw + rand(20,200); });

      // physics (monkey.y is bottom coordinate)
      monkey.vy += monkey.gravity * dt;
      monkey.y += monkey.vy * dt;
      if(monkey.y > monkey.baseline){ monkey.y = monkey.baseline; monkey.vy = 0; }

      // spawn logic (random spacing)
      spawnTimer += dt*1000;
      if(spawnTimer > nextSpawn){ spawnTimer = 0; spawnObstacle(); }

      // move obstacles and remove off-screen
      for(let i=obstacles.length-1;i>=0;i--){
        obstacles[i].x -= speed * dt;
        if(obstacles[i].x + obstacles[i].w < -40) obstacles.splice(i,1);
      }

      // collisions
      if(checkCollisions()){
        running = false;
        startBtn.disabled = false;
        if(score > best){ best = score; localStorage.setItem('monkey_jump_best',String(best)); bestEl.textContent = best; }
        setTimeout(()=> alert('Oh nein â€” getroffen! Dein Score: ' + score), 60);
        render();
        return;
      }

      // scoring & difficulty increase
      obstacles.forEach(o=>{
        if(!o.passed && (o.x + o.w/2) < monkey.x - 10){
          o.passed = true; score++; scoreEl.textContent = score;
          // increase speed per coconut passed
          speed += 6;
        }
      });

      // small periodic acceleration over time (to feel progressively harder)
      accelTimer += dt;
      if(accelTimer > 3){
        accelTimer = 0;
        speed += 2; // slight increase every 3s
      }

      render();
      if(running) requestAnimationFrame(loop);
    }

    // Jump function: if not running -> start, else jump when on ground
    function jump(){
      if(!running){ startGame(); return; }
      if(Math.abs(monkey.y - monkey.baseline) < 8){
        monkey.vy = monkey.jumpVelocity;
      }
    }

    // inputs
    window.addEventListener('keydown',(e)=>{ if(e.code === 'Space'){ e.preventDefault(); jump(); }});
    canvas.addEventListener('pointerdown', ()=>{ jump(); });

    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', restartGame);

    // init
    resetGame(); render();

    // expose for debug
    window.__monkeyJump = { startGame, restartGame, obstacles, palms };
  })();
  </script>
</body>
  </html>
