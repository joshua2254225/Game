<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Harvest Tractor â€” Three.js</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: linear-gradient(#c9f7c5, #7bd87b);
  font-family: system-ui, Arial;
}

/* UI PANEL */
#ui {
  position: fixed;
  top: 12px;
  left: 12px;
  background: rgba(255,255,255,0.92);
  padding: 12px 14px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  min-width: 200px;
}

.stat {
  font-weight: 700;
  margin-bottom: 6px;
}

button {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  border: none;
  border-radius: 8px;
  background: #2b84d8;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
button:hover { background: #1f6fc0; }
</style>
</head>

<body>
<div id="ui">
  <div class="stat">ðŸ’° Geld: <span id="money">0</span></div>
  <div class="stat">ðŸŒ¾ Ressourcen: <span id="res">0</span> / <span id="cap">50</span></div>

  <button id="upSpeed">ðŸšœ Speed Upgrade ($50)</button>
  <button id="upRadius">ðŸŒ± Ernte-Breite Upgrade ($75)</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
/* ============================
   THREE SETUP
============================ */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xa9eaa9);

const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(20, 22, 25);
camera.lookAt(0, 0, 0);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* ============================
   LIGHTING
============================ */
const sun = new THREE.DirectionalLight(0xffffff, 1.2);
sun.position.set(20, 40, 15);
sun.castShadow = true;
scene.add(sun);

scene.add(new THREE.AmbientLight(0xffffff, 0.35));

/* ============================
   GROUND
============================ */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(80, 80),
  new THREE.MeshStandardMaterial({ color: 0x4fae4f })
);
ground.rotation.x = -Math.PI / 2;
ground.receiveShadow = true;
scene.add(ground);

/* ============================
   TRACTOR MODEL (3D)
============================ */
const tractor = new THREE.Group();

const body = new THREE.Mesh(
  new THREE.BoxGeometry(2.6, 1.2, 1.6),
  new THREE.MeshStandardMaterial({ color: 0xe03b3b })
);
body.castShadow = true;
tractor.add(body);

const cabin = new THREE.Mesh(
  new THREE.BoxGeometry(1.2, 1.0, 1.2),
  new THREE.MeshStandardMaterial({ color: 0xffffff })
);
cabin.position.set(0.3, 1, 0);
tractor.add(cabin);

function wheel(x,z){
  const w = new THREE.Mesh(
    new THREE.CylinderGeometry(0.5,0.5,0.5,16),
    new THREE.MeshStandardMaterial({ color: 0x222222 })
  );
  w.rotation.z = Math.PI/2;
  w.position.set(x, -0.3, z);
  w.castShadow = true;
  tractor.add(w);
}
wheel(-1.1,-0.9);
wheel(1.1,-0.9);
wheel(-1.1,0.9);
wheel(1.1,0.9);

tractor.position.y = 0.8;
scene.add(tractor);

/* ============================
   GRASS FIELD
============================ */
const grassTiles = [];
const fieldSize = 35;
const spacing = 1.3;

for(let x=-fieldSize; x<=fieldSize; x++){
  for(let z=-fieldSize; z<=fieldSize; z++){
    if(Math.random() < 0.55){
      const mesh = new THREE.Mesh(
        new THREE.CylinderGeometry(0.18, 0.25, 1, 6),
        new THREE.MeshStandardMaterial({ color: 0x2fa84f })
      );
      mesh.position.set(x*spacing, 0.5, z*spacing);
      mesh.castShadow = true;
      mesh.userData = { cut:false, scale:1 };
      scene.add(mesh);
      grassTiles.push(mesh);
    }
  }
}

/* ============================
   PARTICLES (CUT EFFECT)
============================ */
const particles = [];

function spawnParticles(pos){
  for(let i=0;i<8;i++){
    const p = new THREE.Mesh(
      new THREE.SphereGeometry(0.05,6,6),
      new THREE.MeshStandardMaterial({ color: 0x7bff7b })
    );
    p.position.copy(pos);
    p.velocity = new THREE.Vector3(
      (Math.random()-0.5)*0.2,
      Math.random()*0.15,
      (Math.random()-0.5)*0.2
    );
    scene.add(p);
    particles.push(p);
  }
}

/* ============================
   PLAYER MOVEMENT (SMOOTH)
============================ */
let speed = 0;
let maxSpeed = 0.25;
let turnSpeed = 0.04;
let harvestRadius = 1.4;

let velocity = new THREE.Vector3();

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ============================
   ECONOMY
============================ */
let money = 0;
let resources = 0;
let capacity = 50;

document.getElementById("upSpeed").onclick = () => {
  if(money >= 50){ money -= 50; maxSpeed += 0.06; }
};

document.getElementById("upRadius").onclick = () => {
  if(money >= 75){ money -= 75; harvestRadius += 0.5; }
};

/* ============================
   UPDATE LOOP
============================ */
function animate(){
  requestAnimationFrame(animate);

  /* Movement */
  if(keys["w"] || keys["arrowup"]) speed += 0.006;
  if(keys["s"] || keys["arrowdown"]) speed -= 0.006;

  speed *= 0.97;
  speed = THREE.MathUtils.clamp(speed, -maxSpeed, maxSpeed);

  if(keys["a"] || keys["arrowleft"]) tractor.rotation.y += turnSpeed;
  if(keys["d"] || keys["arrowright"]) tractor.rotation.y -= turnSpeed;

  const forward = new THREE.Vector3(0,0,-1).applyQuaternion(tractor.quaternion);
  tractor.position.add(forward.multiplyScalar(speed));

  /* Grass Cutting */
  grassTiles.forEach(g=>{
    if(g.userData.cut) return;

    const dist = tractor.position.distanceTo(g.position);
    if(dist < harvestRadius && resources < capacity){
      g.userData.cut = true;
      resources += 1;
      spawnParticles(g.position);
    }

    if(g.userData.cut){
      g.scale.y *= 0.9;
      g.rotation.x += 0.08;
    }
  });

  /* Particles update */
  for(let i=particles.length-1;i>=0;i--){
    const p = particles[i];
    p.position.add(p.velocity);
    p.velocity.y -= 0.004;
    p.material.opacity -= 0.02;
    if(p.material.opacity <= 0){
      scene.remove(p);
      particles.splice(i,1);
    }
  }

  /* SELL ZONE */
  if(tractor.position.length() < 3){
    money += resources * 2;
    resources = 0;
  }

  /* UI */
  document.getElementById("money").innerText = money;
  document.getElementById("res").innerText = resources;
  document.getElementById("cap").innerText = capacity;

  renderer.render(scene, camera);
}

animate();

/* ============================
   RESIZE
============================ */
window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
