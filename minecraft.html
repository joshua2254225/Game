<!DOCTYPE html>
<script async src="https://arc.io/widget.min.js#SXrvhKhG"></script>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<title>Minecraft</title>
		<link rel="shortcut icon" type="image/ico" href="https://www.minecraft.net/etc.clientlibs/minecraft/clientlibs/main/resources/favicon.ico">
	</head>
	<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap');
		body {
			overflow: hidden;
			margin: 0;
			padding: 0;
			touch-action: none;
		}
		.world-select {
			width: 99vw;
			min-width: 300px;
			height: calc(100vh - 220px);
			position: absolute;
			bottom: 120px;
			overflow-y: auto;
			background-color: RGBA(0, 0, 0, 0.6);
			justify-content: center;
			margin: 0 auto;
		}
		.world {
			width: 250px;
			height: auto;
			border: 1px solid black;
			font-size: 18px;
			font-family: "Poppins", sans-serif;
			color: rgb(180, 180, 180);
			margin: 0 auto;
			margin-top: 15px;
			padding: 5px;
			cursor: pointer;
		}
		strong {
			color: white;
		}
		.selected {
			border: 3px solid white;
			padding: 3px;
		}
		input[type=text] {
			background-color: black;
			caret-color: white;
			border: 2px solid gray;
			color: white;
			font-size: 24px;
			padding-left: 12px;
		}
		input[type=text]:focus {
			border: 2px solid lightgray;
		}
		#boxcentertop {
			z-index: 1;
			width: 80vw;
			max-width: 400px;
			height: 50px;
			position: relative;
			top: 30px;
			display: block;
			margin: 0 auto;
		}
		.hidden {
			display: none !important;
		}
		#onhover {
			background-color: rgba(0, 0, 0, 0.9);
			color: rgb(200, 200, 200);
			font-family: 'Poppins', sans-serif;
			word-wrap: normal;
			width: auto;
			max-width: 400px;
			position: absolute;
			z-index: 1;
			padding: 10px;
			cursor: default;
		}
		#quota {
			display: block;
			position: absolute;
			width: 99vw;
			margin: 0 auto;
			bottom: 110px;
			z-index: 1;
			background-color: RGBA(0, 0, 0, 0.6);
			justify-content: center;
			text-align: center;
			color: white;
      font-family: 'Poppins', sans-serif;
		}
		
		/* Mobile Controls Styles */
		.mobile-controls {
			position: fixed;
			pointer-events: none;
			z-index: 100;
		}
		
		.mobile-button {
			position: absolute;
			background: rgba(255, 255, 255, 0.3);
			border: 2px solid rgba(255, 255, 255, 0.5);
			border-radius: 50%;
			pointer-events: auto;
			touch-action: none;
			user-select: none;
		}
		
		.joystick-container {
			position: fixed;
			bottom: 20px;
			left: 20px;
			width: 120px;
			height: 120px;
			pointer-events: auto;
		}
		
		.joystick-base {
			width: 100%;
			height: 100%;
			background: rgba(255, 255, 255, 0.2);
			border: 3px solid rgba(255, 255, 255, 0.4);
			border-radius: 50%;
			position: relative;
		}
		
		.joystick-stick {
			width: 50px;
			height: 50px;
			background: rgba(255, 255, 255, 0.5);
			border: 2px solid rgba(255, 255, 255, 0.7);
			border-radius: 50%;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
		}
		
		.action-buttons {
			position: fixed;
			bottom: 20px;
			right: 20px;
			pointer-events: auto;
		}
		
		.action-button {
			width: 60px;
			height: 60px;
			background: rgba(255, 255, 255, 0.3);
			border: 2px solid rgba(255, 255, 255, 0.5);
			border-radius: 50%;
			margin: 10px;
			display: inline-block;
			text-align: center;
			line-height: 60px;
			color: white;
			font-weight: bold;
			font-family: 'Poppins', sans-serif;
			touch-action: none;
			user-select: none;
		}
		
		.look-area {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 70%;
			pointer-events: auto;
			touch-action: none;
		}
		
		@media (max-width: 768px) {
			.mobile-controls {
				display: block;
			}
		}
	</style>
	<body>
	<canvas id="overlay" tabindex="0" width="600" height="600" style="position: absolute; top: 0px; left: 0px"></canvas>
	
	<!-- Mobile Controls -->
	<div class="mobile-controls hidden" id="mobileControls">
		<!-- Look area (top portion of screen for camera) -->
		<div class="look-area" id="lookArea"></div>
		
		<!-- Movement joystick -->
		<div class="joystick-container" id="joystickContainer">
			<div class="joystick-base">
				<div class="joystick-stick" id="joystickStick"></div>
			</div>
		</div>
		
		<!-- Action buttons -->
		<div class="action-buttons">
			<div class="action-button" id="jumpButton">↑</div>
			<div class="action-button" id="breakButton">⛏</div>
			<div class="action-button" id="placeButton">+</div>
		</div>
	</div>
	
	<input type="text" id="savebox" class="hidden" spellcheck="false" style="position: absolute; top: 10px; left: 10px; z-index: 1;">
	<input type="text" id="boxcentertop" class="hidden" spellcheck="false">
	<div id="quota" class="hidden"></div>
	<div id="onhover" class="hidden"></div>
	<p id="savedirections" class="hidden" style="position: absolute; top: 40px; left: 10px; z-index: 1; background-color: rgba(255, 255, 255, 0.3);">
		JSCRAFT!
	</p>
	<div class="world-select hidden" id="worlds"></div>
	<p id="message" class="hidden" style="position: absolute; top: 10px; right: 10px; z-index: 1; text-align: right; background-color: rgba(255, 255, 255, 0.3);"></p>
	<script>
		
		var loadString = ""
		
		// Mobile touch controls
		let mobilecontrols = {
			enabled: false,
			joystick: { x: 0, y: 0, active: false },
			look: { startX: 0, startY: 0, active: false },
			buttons: {
				jump: false,
				break: false,
				place: false
			}
		}
		
		function initMobileControls() {
			// Detect if mobile device
			const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
			                 ('ontouchstart' in window) || 
			                 (navigator.maxTouchPoints > 0);
			
			if (!isMobile) return;
			
			mobileControls.enabled = true;
			const controlsDiv = document.getElementById('mobileControls');
			const joystickContainer = document.getElementById('joystickContainer');
			const joystickStick = document.getElementById('joystickStick');
			const lookArea = document.getElementById('lookArea');
			const jumpButton = document.getElementById('jumpButton');
			const breakButton = document.getElementById('breakButton');
			const placeButton = document.getElementById('placeButton');
			
			// Joystick controls
			function handleJoystickStart(e) {
				e.preventDefault();
				mobileControls.joystick.active = true;
			}
			
			function handleJoystickMove(e) {
				if (!mobileControls.joystick.active) return;
				e.preventDefault();
				
				const touch = e.touches[0];
				const rect = joystickContainer.getBoundingClientRect();
				const centerX = rect.left + rect.width / 2;
				const centerY = rect.top + rect.height / 2;
				
				let deltaX = touch.clientX - centerX;
				let deltaY = touch.clientY - centerY;
				
				const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
				const maxDistance = rect.width / 2 - 25;
				
				if (distance > maxDistance) {
					deltaX = (deltaX / distance) * maxDistance;
					deltaY = (deltaY / distance) * maxDistance;
				}
				
				mobileControls.joystick.x = deltaX / maxDistance;
				mobileControls.joystick.y = deltaY / maxDistance;
				
				joystickStick.style.transform = `translate(calc(-50% + ${deltaX}px), calc(-50% + ${deltaY}px))`;
			}
			
			function handleJoystickEnd(e) {
				e.preventDefault();
				mobileControls.joystick.active = false;
				mobileControls.joystick.x = 0;
				mobileControls.joystick.y = 0;
				joystickStick.style.transform = 'translate(-50%, -50%)';
			}
			
			joystickContainer.addEventListener('touchstart', handleJoystickStart);
			joystickContainer.addEventListener('touchmove', handleJoystickMove);
			joystickContainer.addEventListener('touchend', handleJoystickEnd);
			
			// Look controls
			function handleLookStart(e) {
				e.preventDefault();
				const touch = e.touches[0];
				mobileControls.look.active = true;
				mobileControls.look.startX = touch.clientX;
				mobileControls.look.startY = touch.clientY;
			}
			
			function handleLookMove(e) {
				if (!mobileControls.look.active) return;
				e.preventDefault();
				
				const touch = e.touches[0];
				const deltaX = touch.clientX - mobileControls.look.startX;
				const deltaY = touch.clientY - mobileControls.look.startY;
				
				// Apply camera rotation
				if (typeof p !== 'undefined') {
					const sensitivity = settings.mouseSense / 30000;
					p.rx -= deltaY * sensitivity * 2;
					p.ry += deltaX * sensitivity * 2;
					
					const TAU = Math.PI * 2;
					const PI1_2 = Math.PI / 2;
					while(p.ry > TAU) p.ry -= TAU;
					while(p.ry < 0) p.ry += TAU;
					if(p.rx > PI1_2) p.rx = PI1_2;
					if(p.rx < -PI1_2) p.rx = -PI1_2;
				}
				
				mobileControls.look.startX = touch.clientX;
				mobileControls.look.startY = touch.clientY;
			}
			
			function handleLookEnd(e) {
				e.preventDefault();
				mobileControls.look.active = false;
			}
			
			lookArea.addEventListener('touchstart', handleLookStart);
			lookArea.addEventListener('touchmove', handleLookMove);
			lookArea.addEventListener('touchend', handleLookEnd);
			
			// Button controls
			jumpButton.addEventListener('touchstart', (e) => {
				e.preventDefault();
				mobileControls.buttons.jump = true;
				Key[' '] = true;
			});
			jumpButton.addEventListener('touchend', (e) => {
				e.preventDefault();
				mobileControls.buttons.jump = false;
				Key[' '] = false;
			});
			
			breakButton.addEventListener('touchstart', (e) => {
				e.preventDefault();
				mobileControls.buttons.break = true;
				Key.leftMouse = true;
			});
			breakButton.addEventListener('touchend', (e) => {
				e.preventDefault();
				mobileControls.buttons.break = false;
				Key.leftMouse = false;
			});
			
			placeButton.addEventListener('touchstart', (e) => {
				e.preventDefault();
				mobileControls.buttons.place = true;
				Key.rightMouse = true;
			});
			placeButton.addEventListener('touchend', (e) => {
				e.preventDefault();
				mobileControls.buttons.place = false;
				Key.rightMouse = false;
			});
		}
		
		function showMobileControls() {
			if (mobileControls.enabled) {
				document.getElementById('mobileControls').classList.remove('hidden');
			}
		}
		
		function hideMobileControls() {
			if (mobileControls.enabled) {
				document.getElementById('mobileControls').classList.add('hidden');
			}
		}
		
		// Apply joystick input to movement
		function applyMobileMovement() {
			if (!mobileControls.enabled || !mobileControls.joystick.active) return;
			
			const jx = mobileControls.joystick.x;
			const jy = -mobileControls.joystick.y; // Invert Y
			
			// Simulate WASD keys
			Key.w = jy > 0.3;
			Key.s = jy < -0.3;
			Key.a = jx < -0.3;
			Key.d = jx > 0.3;
		}
	</script>
	<script type="x-shader/vertex" id="blockVertexShader">
