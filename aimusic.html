<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Music Engine – v2</title>

<style>
:root { --neon:#00ff88; --bg:#0a0a0c; }
body{
  margin:0;
  background:var(--bg);
  color:var(--neon);
  font-family:Segoe UI,sans-serif;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.panel{
  width:360px;
  background:rgba(20,20,25,.95);
  border:2px solid var(--neon);
  border-radius:22px;
  padding:30px;
  text-align:center;
  box-shadow:0 0 35px rgba(0,255,136,.35);
}
h1{margin:0;font-size:1.3rem;letter-spacing:4px}
p{font-size:.8rem;opacity:.7}
button{
  width:100%;
  margin-top:22px;
  padding:15px;
  border:none;
  border-radius:50px;
  background:var(--neon);
  color:#000;
  font-weight:800;
  font-size:1.1rem;
  cursor:pointer;
}
.stat{
  margin-top:10px;
  font-family:monospace;
  font-size:.75rem;
}
</style>
</head>

<body>
<div class="panel">
  <h1>AI MUSIC ENGINE</h1>
  <p>Dual Lead • Bass • Groove</p>
  <button id="btn">START ENGINE</button>
  <div class="stat">Lead: <span id="leadNote">-</span></div>
  <div class="stat">Bass: <span id="bassNote">-</span></div>
</div>

<script>
let ctx, master;
let running = false;
let timer;

/* =======================
   MUSIKDATEN
======================= */
// C-Moll → klingt direkt musikalischer
const scale = [
  261.63, // C
  311.13, // Eb
  349.23, // F
  392.00, // G
  466.16, // Bb
  523.25  // C
];

let leadIndex = 3;

/* =======================
   LEAD NOTE
======================= */
function playLead(freq, detune=0){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = "sawtooth";
  osc.frequency.value = freq;
  osc.detune.value = detune;

  gain.gain.setValueAtTime(0.0001, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.18, ctx.currentTime+0.02);
  gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.35);

  osc.connect(gain).connect(master);
  osc.start();
  osc.stop(ctx.currentTime+0.36);
}

/* =======================
   BASS NOTE
======================= */
function playBass(freq){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  const filter = ctx.createBiquadFilter();

  osc.type = "sine";
  osc.frequency.value = freq/2;

  filter.type = "lowpass";
  filter.frequency.value = 120;

  gain.gain.setValueAtTime(0.0001, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.45, ctx.currentTime+0.01);
  gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.5);

  osc.connect(filter).connect(gain).connect(master);
  osc.start();
  osc.stop(ctx.currentTime+0.52);
}

/* =======================
   KICK
======================= */
function playKick(){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = "sine";
  osc.frequency.setValueAtTime(130, ctx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(45, ctx.currentTime+0.15);

  gain.gain.setValueAtTime(0.9, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime+0.15);

  osc.connect(gain).connect(master);
  osc.start();
  osc.stop(ctx.currentTime+0.16);
}

/* =======================
   ENGINE LOOP
======================= */
function startEngine(){
  let step = 0;

  timer = setInterval(()=>{
    // MELODY MOVE
    if(Math.random() < 0.7){
      leadIndex += Math.random()<0.5 ? -1 : 1;
      leadIndex = Math.max(0,Math.min(scale.length-1,leadIndex));
    }

    const leadFreq = scale[leadIndex];

    // DUAL LEAD (2 Töne)
    playLead(leadFreq, -6);
    playLead(leadFreq, +6);

    // BASS auf Zählzeit
    if(step % 2 === 0){
      playBass(leadFreq);
      bassNote.textContent = (leadFreq/2).toFixed(1)+" Hz";
    }

    // KICK
    playKick();

    leadNote.textContent = leadFreq.toFixed(1)+" Hz";
    step++;
  }, 420);
}

/* =======================
   START
======================= */
btn.onclick = ()=>{
  if(running) return;
  running = true;

  ctx = new (window.AudioContext||window.webkitAudioContext)();
  master = ctx.createGain();
  master.gain.value = 0.8;
  master.connect(ctx.destination);

  // TEST
  playLead(440);
  startEngine();
};
</script>
</body>
</html>
