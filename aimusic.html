<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Composer Pro â€” Stable Engine</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

<style>
:root{--neon:#00ff88;--bg:#0a0a0c}
body{
    margin:0;
    background:var(--bg);
    color:var(--neon);
    font-family:Segoe UI,sans-serif;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
}
canvas{position:fixed;inset:0;z-index:-1}
.panel{
    background:rgba(20,20,25,.92);
    border:2px solid var(--neon);
    border-radius:18px;
    padding:28px;
    width:330px;
    box-shadow:0 0 30px rgba(0,255,136,.25);
    text-align:center;
}
h1{font-size:1.3rem;letter-spacing:4px;margin:0}
p{font-size:.8rem;opacity:.7}
button{
    width:100%;
    margin-top:18px;
    padding:14px;
    border:none;
    border-radius:40px;
    background:var(--neon);
    color:#000;
    font-weight:700;
    font-size:1.1rem;
    cursor:pointer;
}
.stat{
    font-family:monospace;
    font-size:.75rem;
    margin-top:10px;
    opacity:.7;
}
</style>
</head>

<body>
<canvas id="cv"></canvas>

<div class="panel">
    <h1>AI SOUND LOGIC</h1>
    <p>Analyzing â†’ Composing â†’ Playing</p>
    <button id="btn">SYSTEM START</button>
    <div class="stat">Status: <span id="state">IDLE</span></div>
    <div class="stat">Note: <span id="note">-</span></div>
    <div class="stat">Chord: <span id="chord">-</span></div>
</div>

<script>
/* ================= MASTER BUS ================= */
const master = new Tone.Gain(0.9).toDestination();
const limiter = new Tone.Limiter(-1).connect(master);
const reverb = new Tone.Reverb({decay:4,wet:0.4}).connect(limiter);
const delay = new Tone.FeedbackDelay("8n",0.35).connect(reverb);

/* ================= SYNTHS ================= */
const lead = new Tone.MonoSynth({
    oscillator:{type:"sawtooth"},
    filter:{Q:1,type:"lowpass",rolloff:-24},
    envelope:{attack:0.02,decay:0.1,sustain:0.4,release:0.8}
}).connect(delay);

const pad = new Tone.PolySynth(Tone.Synth,{
    oscillator:{type:"triangle"},
    envelope:{attack:1.8,release:2.8}
}).connect(reverb);
pad.volume.value = -12;

const kick = new Tone.MembraneSynth({
    pitchDecay:0.05,
    octaves:10,
    envelope:{attack:0.001,decay:0.4,sustain:0}
}).connect(limiter);

const hat = new Tone.NoiseSynth({
    noise:{type:"white"},
    envelope:{attack:0.001,decay:0.08,sustain:0}
}).connect(limiter);

/* ================= AI DATA ================= */
const scale = ["C3","D3","E3","G3","A3","C4","D4","E4","G4"];
const chords = [
    ["C3","E3","G3"],
    ["A2","C3","E3"],
    ["F2","A2","C3"],
    ["G2","B2","D3"]
];

let idx=4, playing=false;

/* ================= LOOPS ================= */
const melody = new Tone.Loop(time=>{
    idx += Math.floor(Math.random()*3)-1;
    idx=Math.max(0,Math.min(scale.length-1,idx));
    lead.triggerAttackRelease(scale[idx],"8n",time);
    note.textContent=scale[idx];
},"8n");

const harmony = new Tone.Loop(time=>{
    const c=chords[Math.floor(Math.random()*chords.length)];
    pad.triggerAttackRelease(c,"2n",time);
    chord.textContent=c.join("-");
},"2n");

const drums = new Tone.Loop(time=>{
    kick.triggerAttackRelease("C1","8n",time);
    if(Math.random()>0.5) hat.triggerAttackRelease("16n",time+Tone.Time("8n"));
},"4n");

/* ================= START LOGIC ================= */
btn.onclick = async ()=>{
    if(playing) return;

    state.textContent="INITIALIZING...";
    await Tone.start();
    Tone.Transport.bpm.value=110;

    /* ðŸ”¹ 1 SEKUNDE PRE-COMPUTE */
    setTimeout(()=>{
        state.textContent="PLAYING";
        melody.start(0);
        harmony.start(0);
        drums.start(0);
        Tone.Transport.start("+0.1");
        playing=true;
    },1000);
};

/* ================= VISUAL ================= */
const c=document.getElementById("cv"),x=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
window.onresize=resize;resize();

function draw(){
    x.fillStyle="rgba(10,10,12,.15)";
    x.fillRect(0,0,c.width,c.height);
    if(playing){
        x.strokeStyle="rgba(0,255,136,.5)";
        x.beginPath();
        x.arc(Math.random()*c.width,Math.random()*c.height,40,0,Math.PI*2);
        x.stroke();
    }
    requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
