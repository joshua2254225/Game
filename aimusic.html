<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Composer Pro v3</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

<style>
:root{
    --neon:#00ff88;
    --bg:#0a0a0c;
    --panel:#141419;
}
body{
    margin:0;
    background:var(--bg);
    color:var(--neon);
    font-family:Segoe UI, sans-serif;
    height:100vh;
    overflow:hidden;
}
canvas{
    position:absolute;
    inset:0;
    z-index:-1;
}
.container{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:rgba(20,20,25,.9);
    border:2px solid var(--neon);
    border-radius:20px;
    padding:30px;
    width:340px;
    box-shadow:0 0 30px rgba(0,255,136,.25);
}
h1{
    margin:0;
    letter-spacing:4px;
    font-size:1.4rem;
}
p{opacity:.7;font-size:.85rem;margin-bottom:20px}
button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:40px;
    background:var(--neon);
    color:#000;
    font-weight:700;
    font-size:1.1rem;
    cursor:pointer;
}
button:hover{box-shadow:0 0 20px var(--neon)}
.control{
    margin-top:15px;
    font-size:.8rem;
}
input[type=range]{
    width:100%;
}
.stat{
    font-family:monospace;
    margin-top:10px;
    font-size:.75rem;
    opacity:.7;
}
</style>
</head>

<body>
<canvas id="bg"></canvas>

<div class="container">
    <h1>AI SOUND LOGIC</h1>
    <p>Generative Music Engine</p>

    <button id="toggle">SYSTEM START</button>

    <div class="control">
        Tempo
        <input id="tempo" type="range" min="60" max="150" value="110">
    </div>

    <div class="control">
        Mood (Dark â†” Bright)
        <input id="mood" type="range" min="0" max="100" value="50">
    </div>

    <div class="control">
        Energy
        <input id="energy" type="range" min="0" max="100" value="60">
    </div>

    <div class="stat">Note: <span id="note">-</span></div>
    <div class="stat">Chord: <span id="chord">-</span></div>
    <div class="stat">Beat: <span id="beat">-</span></div>
</div>

<script>
// ---------------- AUDIO ----------------
const reverb = new Tone.Reverb(4).toDestination();
const delay  = new Tone.FeedbackDelay("8n",.35).connect(reverb);

const lead = new Tone.MonoSynth({
    oscillator:{type:"sawtooth"},
    envelope:{attack:.02,decay:.1,sustain:.4,release:1}
}).connect(delay);

const pad = new Tone.PolySynth(Tone.Synth,{
    oscillator:{type:"triangle"},
    envelope:{attack:2,release:3}
}).connect(reverb);
pad.volume.value=-14;

const kick  = new Tone.MembraneSynth().toDestination();
const snare = new Tone.NoiseSynth({volume:-10}).toDestination();
const hat   = new Tone.NoiseSynth({volume:-25}).toDestination();

// ---------------- AI DATA ----------------
const scales = {
    dark:["C3","Eb3","F3","G3","Bb3","C4","Eb4","F4","G4"],
    bright:["C3","D3","E3","G3","A3","C4","D4","E4","G4"]
};

const chords = {
    dark:[
        ["C3","Eb3","G3"],
        ["Ab2","C3","Eb3"],
        ["Bb2","D3","F3"]
    ],
    bright:[
        ["C3","E3","G3"],
        ["A2","C3","E3"],
        ["F2","A2","C3"]
    ]
};

let index=4, playing=false;

// ---------------- CONTROLS ----------------
const tempo=document.getElementById("tempo");
tempo.oninput=()=>Tone.Transport.bpm.value=tempo.value;

function moodType(){
    return mood.value<50?"dark":"bright";
}

// ---------------- LOOPS ----------------
const melody=new Tone.Loop(time=>{
    const scale=scales[moodType()];
    index+=Math.floor(Math.random()*3)-1;
    index=Math.max(0,Math.min(scale.length-1,index));
    if(Math.random()<energy.value/100){
        lead.triggerAttackRelease(scale[index],"8n",time);
        note.innerText=scale[index];
    }
},"8n");

const harmony=new Tone.Loop(time=>{
    const c=chords[moodType()];
    const chord=c[Math.floor(Math.random()*c.length)];
    pad.triggerAttackRelease(chord,"2n",time);
    chordOut=chord.join("-");
    chord.innerText=chordOut;
},"2n");

const drums=new Tone.Loop(time=>{
    kick.triggerAttackRelease("C1","8n",time);
    if(Math.random()>.5) snare.triggerAttackRelease("16n",time+"8n");
    if(Math.random()>.3) hat.triggerAttackRelease("16n",time+"16n");
    beat.innerText="K-S-H";
},"4n");

// ---------------- START ----------------
toggle.onclick=async()=>{
    if(!playing){
        await Tone.start();
        Tone.Transport.start();
        melody.start(0);
        harmony.start(0);
        drums.start(0);
        toggle.innerText="SYSTEM STOP";
        playing=true;
    }else{
        Tone.Transport.stop();
        toggle.innerText="SYSTEM START";
        playing=false;
    }
};

// ---------------- VISUALS ----------------
const c=document.getElementById("bg");
const x=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
window.onresize=resize;resize();

function draw(){
    x.fillStyle="rgba(10,10,12,.15)";
    x.fillRect(0,0,c.width,c.height);
    if(playing){
        const r=energy.value;
        x.strokeStyle=`rgba(0,255,136,.6)`;
        x.beginPath();
        x.arc(Math.random()*c.width,Math.random()*c.height,r,0,Math.PI*2);
        x.stroke();
    }
    requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
