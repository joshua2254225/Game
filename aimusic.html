<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Music Engine â€“ Pure WebAudio</title>

<style>
:root { --neon:#00ff88; --bg:#0a0a0c; }
body{
  margin:0;
  background:var(--bg);
  color:var(--neon);
  font-family:Segoe UI, sans-serif;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.panel{
  background:rgba(20,20,25,.95);
  border:2px solid var(--neon);
  border-radius:20px;
  padding:30px;
  width:340px;
  text-align:center;
  box-shadow:0 0 30px rgba(0,255,136,.3);
}
h1{margin:0;letter-spacing:4px;font-size:1.3rem}
p{opacity:.7;font-size:.8rem}
button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:40px;
  background:var(--neon);
  color:#000;
  font-weight:700;
  font-size:1.1rem;
  cursor:pointer;
}
.stat{
  margin-top:10px;
  font-family:monospace;
  font-size:.75rem;
  opacity:.8;
}
</style>
</head>

<body>
<div class="panel">
  <h1>AI MUSIC ENGINE</h1>
  <p>Pure Web Audio â€¢ No Libraries</p>
  <button id="btn">SYSTEM START</button>
  <div class="stat">Note: <span id="note">-</span></div>
</div>

<script>
/* =====================================================
   AUDIO CONTEXT (PURE WEB AUDIO)
===================================================== */
let ctx, master;
let playing = false;
let timer;

/* =====================================================
   MUSIKDATEN
===================================================== */
const scale = [261.63,293.66,329.63,392.00,440.00,523.25]; // C-Dur
let idx = 2;

/* =====================================================
   NOTE SPIELEN (GARANTIERT HÃ–RBAR)
===================================================== */
function playNote(freq, duration=0.2){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = "sawtooth";
  osc.frequency.value = freq;

  gain.gain.setValueAtTime(0.0001, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime + 0.01);
  gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration);

  osc.connect(gain).connect(master);
  osc.start();
  osc.stop(ctx.currentTime + duration);
}

/* =====================================================
   BEAT (KICK)
===================================================== */
function playKick(){
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();

  osc.type = "sine";
  osc.frequency.setValueAtTime(120, ctx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(40, ctx.currentTime + 0.15);

  gain.gain.setValueAtTime(0.8, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);

  osc.connect(gain).connect(master);
  osc.start();
  osc.stop(ctx.currentTime + 0.16);
}

/* =====================================================
   LOOP ENGINE
===================================================== */
function startEngine(){
  timer = setInterval(()=>{
    // Melodie
    idx += Math.floor(Math.random()*3)-1;
    idx = Math.max(0,Math.min(scale.length-1,idx));
    playNote(scale[idx]);
    note.textContent = scale[idx].toFixed(1)+" Hz";

    // Beat
    playKick();
  }, 400);
}

/* =====================================================
   START BUTTON (USER GESTE â†’ AUDIO FREI)
===================================================== */
btn.onclick = ()=>{
  if(playing) return;
  playing = true;

  ctx = new (window.AudioContext || window.webkitAudioContext)();
  master = ctx.createGain();
  master.gain.value = 0.8;
  master.connect(ctx.destination);

  // ðŸ”Š TESTTON (WENN DER KOMMT â†’ ALLES OK)
  playNote(440,0.15);

  startEngine();
};
</script>
</body>
</html>
